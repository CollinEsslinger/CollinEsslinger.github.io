<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feuer-Quiz – Für die Grundschule</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="Feuer Icon.png">
  <link rel="shortcut icon" type="image/png" href="Feuer Icon.png">
  <link rel="apple-touch-icon" href="Feuer Icon.png">

  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: #fbeee6;
      margin: 0;
      padding: 0;
      color: #333;
    }

    .quiz-container {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    h1 { text-align: center; margin-top: 0; color: #b1382b; }

    .question { margin-bottom: 30px; }
    .question h2 { margin-top: 0; font-size: 1.2em; color: #622b00; }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }

    label.option {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      cursor: pointer;
      background: #fafafa;
      transition: background 0.2s, border-color 0.2s;
      text-align: center;
      user-select: none;
    }
    label.option:hover { background: #f2f2f2; border-color: #b1382b; }
    label.option input { margin-bottom: 8px; transform: scale(1.3); accent-color: #b1382b; }

    /* Einheitliche Bildgröße für ALLE Bilder (Fragen, Ergebnis, Kärtchen) */
    label.option img,
    .sortable-item img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      margin-bottom: 6px;
      display: block;
    }

    button.btn {
      background: #b1382b;
      color: #fff;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      display: block;
      width: 100%;
    }
    button.btn:hover { background: #8d2e24; }

    /* Ergebnis-Hervorhebungen */
    label.option.correct-answer { border-color: #28a745; background-color: #e9f7ef; }
    label.option.wrong-answer   { border-color: #dc3545; background-color: #fcebea; }
    label.option.unselected-correct-answer { background-color: #e9f7ef; border-color: #ddd; }

    .points-box { background: #b1382b; color: #ffffff; border-radius: 6px; padding: 4px 8px; font-size: 0.85em; display: inline-block; margin-top: 8px; }
    .points-box-wrapper { text-align: right; margin-top: 8px; }
    .summary-text { color: #b1382b; }

    .question-step { display: none; }

    /* Sortierliste & Karten */
    .sortable { list-style: none; padding: 0; margin: 10px 0 0; position: relative; }
    .sortable-item {
      display: flex;
      align-items: center;
      gap: 10px;
      border: 1px dashed #ccc;
      border-radius: 8px;
      background: #fafafa;
      padding: 10px;
      margin-bottom: 8px;
      touch-action: none;        /* wichtig für Pointer/Touch */
      transition: transform 150ms ease; /* FLIP-Animation */
      cursor: grab;
      user-select: none;
    }
    .sortable-item:active { cursor: grabbing; }

    /* Platzhalter-Lücke */
    .placeholder {
      border: 2px dashed #b1382b;
      border-radius: 8px;
      background: #fff7f5;
      margin-bottom: 8px;
      height: 0; /* wird dynamisch gesetzt */
    }

    /* Die „schwebende“ gezogene Karte (hängt am Finger/Maus) */
    .drag-ghost {
      position: fixed; /* folgt dem Pointer zuverlässig */
      left: 0; top: 0;
      width: 0; /* wird dynamisch gesetzt */
      z-index: 999;
      pointer-events: none;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
      opacity: 1; /* explizit opaque */
      transform: translate3d(0,0,0);
      transition: none; /* keine FLIP-Transition auf dem Ghost */
      background: #fafafa;
      border: 1px dashed #ccc;
      border-radius: 8px;
      user-select: none;
    }

    /* Ergebnis-Ansicht: Platz für fixen Button unten schaffen */
    .result-pad-bottom {
      padding-bottom: calc(96px + env(safe-area-inset-bottom, 0px));
    }

    /* Fixierter Mega-Button am unteren Bildschirmrand (nur in der Auswertung sichtbar) */
    .btn-fixed-bottom {
      position: fixed; left: 0; right: 0; bottom: 0; z-index: 1000;
      background: #b1382b; color: #fff; border: none; font-size: 1.25rem;
      padding: 18px 24px; border-radius: 0; width: 100%; cursor: pointer;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.08);
      padding-bottom: calc(18px + env(safe-area-inset-bottom, 0px)); /* iOS Safe Area */
    }
    .btn-fixed-bottom:hover { background: #8d2e24; }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1>Feuer-Quiz</h1>
    <p>Woran kannst du dich erinnern? Versuche, alle Fragen richtig zu beantworten!</p>

    <form id="quizForm">
      <!-- Schritt 1 -->
      <div class="question-step" id="step1" style="display: block;">
        <div class="question">
          <h2>1. Was braucht man alles, um Feuer zu machen?</h2>
          <p>(Mehrere Antworten sind möglich)</p>
          <div class="options-grid">
            <label class="option"><input type="checkbox" name="q1" value="Feuerstein" /><img src="1.1 Feuerstein.jpg" alt="Feuerstein" /><span>Feuerstein</span></label>
            <label class="option"><input type="checkbox" name="q1" value="Sonnenblumenkerne" /><img src="1.2 Sonnenblumenkerne.jpg" alt="Sonnenblumenkerne" /><span>Sonnenblumenkerne</span></label>
            <label class="option"><input type="checkbox" name="q1" value="Zunder" /><img src="1.3 Zunder.jpg" alt="Zunder" /><span>Zunder</span></label>
            <label class="option"><input type="checkbox" name="q1" value="Stück Stahl" /><img src="1.4 Feuerstahl.jpg" alt="Stück Stahl" /><span>Stück Stahl</span></label>
            <label class="option"><input type="checkbox" name="q1" value="Distelsamen" /><img src="1.5 Distelsamen.jpg" alt="Distelsamen" /><span>Distelsamen</span></label>
            <label class="option"><input type="checkbox" name="q1" value="Aluminium-Stab" /><img src="1.6 Aluminium-Stab.jpg" alt="Aluminium-Stab" /><span>Aluminium-Stab</span></label>
            <label class="option"><input type="checkbox" name="q1" value="Stroh" /><img src="1.7 Stroh.jpg" alt="Stroh" /><span>Stroh</span></label>
            <label class="option"><input type="checkbox" name="q1" value="Holz" /><img src="1.8 Holz.jpg" alt="Holz" /><span>Holz</span></label>
          </div>
        </div>
        <button type="button" class="btn" onclick="nextStep();">Weiter</button>
      </div>

      <!-- Schritt 2 -->
      <div class="question-step" id="step2">
        <div class="question">
          <h2>2. Was braucht ein Feuer immer unbedingt, um zu brennen?</h2>
          <div class="options-grid">
            <label class="option"><input type="radio" name="q2" value="Wachs" /><img src="2.1 Wachs.jpg" alt="Wachs" /><span>Wachs</span></label>
            <label class="option"><input type="radio" name="q2" value="Wasser" /><img src="2.2 Wasser.jpg" alt="Wasser" /><span>Wasser</span></label>
            <label class="option"><input type="radio" name="q2" value="Luft" /><img src="2.3 Luft.jpg" alt="Luft" /><span>Luft</span></label>
            <label class="option"><input type="radio" name="q2" value="Feuerzeug" /><img src="2.4 Feuerzeug.jpg" alt="Feuerzeug" /><span>Feuerzeug</span></label>
          </div>
        </div>
        <button type="button" class="btn" onclick="nextStep();">Weiter</button>
      </div>

      <!-- Schritt 3 -->
      <div class="question-step" id="step3">
        <div class="question">
          <h2>3. Was nutzt Martin, um nicht die ganze Zeit mit dem Mund zu blasen?</h2>
          <div class="options-grid">
            <label class="option"><input type="radio" name="q3" value="Luftpumpe" /><img src="3.1 Luftpumpe.jpg" alt="Luftpumpe" /><span>Luftpumpe</span></label>
            <label class="option"><input type="radio" name="q3" value="Blasebalg" /><img src="3.2 Blasebalg.jpg" alt="Blasebalg" /><span>Blasebalg</span></label>
            <label class="option"><input type="radio" name="q3" value="Hände" /><img src="3.3 Haende.jpg" alt="Hände" /><span>Hände</span></label>
            <label class="option"><input type="radio" name="q3" value="Blasrohr" /><img src="3.4 Blasrohr.jpg" alt="Blasrohr" /><span>Blasrohr</span></label>
          </div>
        </div>
        <button type="button" class="btn" onclick="nextStep();">Weiter</button>
      </div>

      <!-- Schritt 4: Reihenfolge -->
      <div class="question-step" id="step4">
        <div class="question">
          <h2>4. Bringe die Schritte zum Feuer machen in die richtige Reihenfolge.</h2>
          <p>Ziehe die Kärtchen an die richtige Position.</p>
          <ul id="q4-list" class="sortable">
            <li class="sortable-item" data-id="ZunderDistelsamen" data-correct-pos="2">
              <img src="4.2 ZunderDistelsamen.jpg" alt="Zunder in Distelsamen legen">
              <span class="title">Zunder in Distelsamen legen</span>
            </li>
            <li class="sortable-item" data-id="StrohBlasebalg" data-correct-pos="4">
              <img src="4.4 StrohBlasebalg.jpg" alt="Stroh mit Blasebalg anfeuern">
              <span class="title">Stroh mit Blasebalg anfeuern</span>
            </li>
            <li class="sortable-item" data-id="ZunderFeuerstein" data-correct-pos="1">
              <img src="4.1 ZunderFeuerstein.jpg" alt="Zunder am Feuerstein zum Glimmen bringen">
              <span class="title">Zunder am Feuerstein zum Glimmen bringen</span>
            </li>
            <li class="sortable-item" data-id="StrohHolz" data-correct-pos="5">
              <img src="4.5 StrohHolz.jpg" alt="Holz-Stückchen auf brennendes Stroh legen">
              <span class="title">Holz-Stückchen auf brennendes Stroh legen</span>
            </li>
            <li class="sortable-item" data-id="DistelsamenStroh" data-correct-pos="3">
              <img src="4.3 DistelsamenStroh.jpg" alt="qualmenden Distelsamen in Stroh einpacken">
              <span class="title">qualmenden Distelsamen in Stroh einpacken</span>
            </li>
          </ul>
        </div>
        <button type="button" class="btn" onclick="submitQuiz();">Überprüfen</button>
      </div>

      <!-- Ergebnis -->
      <div class="question-step" id="step5" style="display: none;"></div>
    </form>
  </div>

  <script>
  function enableSortableWithSnap(ul) {
    let dragging = null;
    let ghost = null;
    let placeholder = null;
    let offsetY = 0;
    let ghostWidth = 0;
    let started = false;

    const items = () => Array.from(ul.querySelectorAll('.sortable-item'));
    const siblings = () => items();

    function flipAnimate(beforeRects) {
      const els = siblings();
      els.forEach(el => {
        const first = beforeRects.get(el);
        const last = el.getBoundingClientRect();
        if (!first) return;
        const dx = first.left - last.left;
        const dy = first.top  - last.top;
        if (dx || dy) {
          el.style.transform = `translate(${dx}px, ${dy}px)`;
          el.style.transition = 'transform 0s';
          requestAnimationFrame(() => {
            el.style.transition = 'transform 150ms ease';
            el.style.transform = '';
          });
        }
      });
    }

    function recordRects() {
      const map = new Map();
      siblings().forEach(el => map.set(el, el.getBoundingClientRect()));
      return map;
    }

    function onPointerDown(e) {
      const target = e.target.closest('.sortable-item');
      if (!target) return;
      e.preventDefault();
      started = true;
      dragging = target;

      const rect = dragging.getBoundingClientRect();
      ghostWidth = rect.width;
      offsetY = e.clientY - rect.top;

      placeholder = document.createElement('li');
      placeholder.className = 'placeholder';
      placeholder.style.height = rect.height + 'px';
      placeholder.style.marginBottom = getComputedStyle(dragging).marginBottom;
      ul.insertBefore(placeholder, dragging.nextSibling);

      // Original-Element aus dem DOM entfernen
      ul.removeChild(dragging);

      // Drag-Ghost
      ghost = dragging.cloneNode(true);
      ghost.classList.add('drag-ghost');
      ghost.style.width = rect.width + 'px';
      ghost.style.height = rect.height + 'px';
      document.body.appendChild(ghost);

      moveGhost(e.clientX, e.clientY);

      window.addEventListener('pointermove', onPointerMove, { passive: false });
      window.addEventListener('pointerup', onPointerUp, { passive: false });
    }

    function moveGhost(clientX, clientY) {
      const x = Math.min(Math.max(clientX, 0), window.innerWidth);
      const y = clientY - offsetY;
      ghost.style.transform = `translate(${x - ghostWidth/2}px, ${y}px)`;
    }

    function onPointerMove(e) {
      if (!started || !ghost) return;
      e.preventDefault();

      moveGhost(e.clientX, e.clientY);

      const beforeRects = recordRects();

      const ghostRect = ghost.getBoundingClientRect();
      const centerY = ghostRect.top + ghostRect.height / 2;

      const els = siblings();
      let placed = false;
      for (let i = 0; i < els.length; i++) {
        const r = els[i].getBoundingClientRect();
        const mid = r.top + r.height / 2;
        if (centerY < mid) {
          ul.insertBefore(placeholder, els[i]);
          placed = true;
          break;
        }
      }
      if (!placed) ul.appendChild(placeholder);

      flipAnimate(beforeRects);
    }

    function onPointerUp() {
      if (!started) return;
      started = false;

      ul.insertBefore(dragging, placeholder);
      placeholder.remove();
      ghost.remove();
      placeholder = null;
      ghost = null;
      dragging = null;

      window.removeEventListener('pointermove', onPointerMove);
      window.removeEventListener('pointerup', onPointerUp);
    }

    // ==== WICHTIGER FIX: nach dem Klonen die Referenz 'ul' aktualisieren ====
    const fresh = ul.cloneNode(true);
    ul.parentNode.replaceChild(fresh, ul);
    ul = fresh; // <- ohne diese Zeile zeigen alle Closures auf das alte, abgehängte UL!

    // (Optional, aber hilfreich auf Touch-Geräten:)
    ul.style.touchAction = 'none';

    ul.addEventListener('pointerdown', onPointerDown, { passive: false });
  }
</script>
</body>
</html>
